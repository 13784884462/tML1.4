--- src/Terraria/Terraria/Netplay.cs
+++ src/tModLoader/Terraria/Netplay.cs
@@ -1,27 +_,31 @@
 using System;
+using System.Collections.Concurrent;
 using System.IO;
 using System.Linq;
 using System.Net;
 using System.Net.Sockets;
+
 #if !WINDOWS
 using System.Runtime.CompilerServices;
 #endif
 using System.Threading;
+using System.Threading.Tasks;
 using Terraria.Audio;
 using Terraria.IO;
 using Terraria.Localization;
 using Terraria.Map;
+using Terraria.ModLoader;
 using Terraria.Net;
 using Terraria.Net.Sockets;
 using Terraria.Social;
 using Terraria.Utilities;
+
 #if !WINDOWS
 using Terraria.Social.Base;
 #endif
-#if SERVER
+#if SERVER && WINDOWS
 using NATUPNPLib;
 #endif
-
 namespace Terraria
 {
 	public class Netplay
@@ -49,7 +_,7 @@
 		public static bool SpamCheck = false;
 		public static bool HasClients;
 		private static Thread _serverThread;
-#if SERVER
+#if SERVER && WINDOWS
 		public static UPnPNAT _upnpnat;
 		public static IStaticPortMappingCollection _mappings;
 #endif
@@ -91,6 +_,8 @@
 				Main.txMsgType[i] = 0;
 				Main.txDataType[i] = 0;
 			}
+
+			ModNet.ResetNetDiag();
 		}
 
 		public static void ResetSections() {
@@ -129,9 +_,23 @@
 
 			return false;
 		}
 
+		private static readonly ConcurrentQueue<Task> mainThreadTasks = new ConcurrentQueue<Task>();
+
+		internal static void OnUpdate() {
+			Task t;
+			while (mainThreadTasks.TryDequeue(out t))
+				t.RunSynchronously();
+		}
+
+		private static void InvokeOnMainThread(Action action) {
+			var t = new Task(action);
+			mainThreadTasks.Enqueue(t);
+			t.Wait();
+		}
+
 		private static void OpenPort(int port) {
-#if SERVER
+#if SERVER && WINDOWS
 			if (Netplay.upnpnat == null)
 			{
 				Netplay.upnpnat = (UPnPNAT)Activator.CreateInstance(Type.GetTypeFromCLSID(new Guid("AE1E00AA-3FD5-403C-8A27-2BBDC30CD0E1")));
@@ -156,7 +_,7 @@
 		}
 
 		private static void ClosePort(int port) {
-#if SERVER
+#if SERVER && WINDOWS
 			if (Netplay.portForwardOpen)
 			{
 				Netplay.mappings.Remove(Netplay.portForwardPort, "TCP");
@@ -364,5 +_,5 @@
 
 		private static void UpdateClient() {
 			if (Main.netMode == 1 && Connection.Socket.IsConnected() && NetMessage.buffer[256].checkBytes)
-				NetMessage.CheckBytes();
+				InvokeOnMainThread(() => NetMessage.CheckBytes());
 		}
@@ -425,6 +_,7 @@
 		}
 
 		private static void ClientLoopSetup(RemoteAddress address) {
+			Logging.Terraria.InfoFormat("Connecting to {0}", address.GetFriendlyName());
 			ResetNetDiag();
 			Main.ServerSideCharacter = false;
 			if (Main.rand == null)
@@ -444,9 +_,11 @@
 
 			Disconnect = false;
 			Connection = new RemoteServer();
-			Connection.ReadBuffer = new byte[1024];
+			Connection.ReadBuffer = new byte[ushort.MaxValue];
 		}
 
+
+		internal static bool syncingWorld = false;
 		private static void InnerClientLoop() {
 			try {
 				NetMessage.buffer[256].Reset();
@@ -489,6 +_,7 @@
 						else if (Connection.State == 5 && WorldGen.worldCleared) {
 							Connection.State = 6;
 							Main.player[Main.myPlayer].FindSpawn();
+							syncingWorld = true;
 							NetMessage.SendData(8, -1, -1, null, Main.player[Main.myPlayer].SpawnX, Main.player[Main.myPlayer].SpawnY);
 						}
 
@@ -511,8 +_,6 @@
 								Main.statusText = Connection.StatusText + ": " + (int)((float)Connection.StatusCount / (float)Connection.StatusMax * 100f) + "%";
 							}
 						}
-
-						Thread.Sleep(1);
 					}
 					else if (Connection.IsActive) {
 						Main.statusText = Language.GetTextValue("Net.LostConnection");
@@ -522,6 +_,7 @@
 					num = Connection.State;
 				}
 
+				syncingWorld = false;
 				try {
 					Connection.Socket.Close();
 				}
